{% macro ticket_table(tickets) %}
<table>
    <tr>
        <th>
            Key
        </th>
        <th>
            Summary
        </th>
    </tr>
    {% for t in tickets %}
    <tr>
        <td>
            {{ t.key }}
        </td>
        <td>
            {{ t.summary }}
        </td>
    </tr>
    {% endfor %}
</table>
{% endmacro %}


{% macro tickets_preview(tickets, unique_id='preview') %}
<style>
 .ticket-list, .ticket-preview {
     height: 100%;
 }

 .tickets {
     overflow-x: hidden;
 }

 .ticket-list, .ticket-preview {
     overflow-y: scroll;
 }

 .ticket-list {
     border-right: 1px solid #ddd;
 }

 .ticket-preview .separator {
     padding-bottom: 1rem;
 }

 .ticket-stub {
     background-color: white;
     padding: 1rem;
     overflow-x: hidden;
     border-bottom: 1px solid #ddd;
 }

 .ticket-stub:hover, .ticket-stub.active {
     color: white;
     background-color: #995197;
     cursor: pointer;
 }

 .ticket-stub p {
     margin-bottom: 0;
 }
</style>

<div class="row">
    <div id="{{ unique_id }}-ticket-list" class="ticket-list col-md-3">
        {% for t in tickets %}
        <div class="{{ unique_id }}-ticket-stub ticket-stub" id="{{ t.key }}"
             onclick="{{ unique_id }}LoadPreview(this)">
            <b>{{ t.key }}</b>
            <p>{{ t.summary }}</p>
        </div>
        {% endfor %}
    </div>
    <div id="{{ unique_id }}-preview" class="col-md-9 ticket-preview">
        {% raw %}
        <h1 class="separator">
            {{ summary }}

            <a v-bind:href="url" class="btn btn-primary pull-right">Detail</a>
        </h1>
        <div v-html="description"></div>
        {% endraw %}
    </div>
</div>

<script>
 var defaultTicket = document.getElementById('{{ unique_id }}-ticket-list').
                              children[0];
 var converter = new showdown.Converter();

 var {{ unique_id }}_preview = new Vue({
     el: '#{{ unique_id }}-preview',
     data: {
         key: '',
         summary: '',
         description: '',
         url: ''
     }
 });


 function {{ unique_id }}LoadPreview(tickEle) {
     console.log($('.{{ unique_id }}-ticket-stub.active'))
     console.log(tickEle)
     $('.{{ unique_id }}-ticket-stub.active').removeClass('active');
     $(tickEle).addClass('active');

     fetch('/api/v1/tickets/'+tickEle.id)
         .then(function(res) {
             return res.json();
         })
         .then(function(jsn) {
             {{ unique_id }}_preview.key = jsn.key;
             {{ unique_id }}_preview.summary = jsn.summary;
             {{ unique_id }}_preview.description = converter.makeHtml(jsn.description);
             {{ unique_id }}_preview.url = '/'+jsn.key.split('-')[0]+'/'+jsn.key;
         })
 }

 {{ unique_id }}LoadPreview(defaultTicket);
</script>
{% endmacro %}
